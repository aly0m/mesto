(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=e.url,this._headers=e.headers}var n,r;return n=t,(r=[{key:"_handleResponse",value:function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))}},{key:"getInititalCards",value:function(){return fetch("".concat(this._url,"/cards"),{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"getUserInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:this._headers}).then(this._handleResponse)}},{key:"editUserInfo",value:function(e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e["field-name"],about:e["field-job"]})}).then(this._handleResponse)}},{key:"editUserAvatar",value:function(e){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e["field-avatar"]})}).then(this._handleResponse)}},{key:"addCard",value:function(e){return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e["field-place"],link:e["field-link"]})}).then(this._handleResponse)}},{key:"deleteCard",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}},{key:"addLike",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then(this._handleResponse)}},{key:"removeLike",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then(this._handleResponse)}}])&&e(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=r,this._container=n}var t,r;return t=e,(r=[{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}},{key:"appendItem",value:function(e){this._container.append(e)}},{key:"prependItem",value:function(e){this._container.prepend(e)}}])&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=t.data,o=t.handleCardClick,i=t.handleRemoveClick,a=t.handleLikeClick,c=t.userId;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=r,this._name=r.name,this._link=r.link,this._ownerId=r.owner._id,this._id=r._id,this._handleCardClick=o,this._handleRemoveClick=i,this._handleLikeClick=a,this._userId=c,this._likes=r.likes.length,this._templateSelector=n}var t,n;return t=e,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}},{key:"getId",value:function(){return this._id}},{key:"generateCard",value:function(){var e=this;return this._element=this._getTemplate(),this._elementImage=this._element.querySelector(".element__image"),this._elementTitle=this._element.querySelector(".element__title"),this._likeButton=this._element.querySelector(".element__like-btn"),this._deleteButton=this._element.querySelector(".element__delete-btn"),this._likeCount=this._element.querySelector(".element__like-count"),this._data.likes.forEach((function(t){t._id===e._userId&&e._likeButton.classList.add("element__like-btn_active")})),this._ownerId!==this._userId&&this._deleteButton.remove(),this._setEventListeners(),this._elementImage.src=this._link,this._elementImage.alt="Изображение места - "+this._name,this._elementTitle.textContent=this._name,this._likeCount.textContent=this._likes,this._element}},{key:"deleteCardHandler",value:function(){this._element.remove(),this._element=null}},{key:"likeCardHandler",value:function(e){this._likeButton.classList.toggle("element__like-btn_active"),this._likeCount.textContent=e}},{key:"_setEventListeners",value:function(){var e=this;this._likeButton.addEventListener("click",this._handleLikeClick),this._deleteButton.addEventListener("click",this._handleRemoveClick),this._elementImage.addEventListener("click",(function(){e._handleCardClick(e._name,e._link)}))}}])&&o(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"enableValidation",(function(){r._setEventListeners()})),c(this,"_setEventListeners",(function(){r._inputsList.forEach((function(e){e.addEventListener("input",(function(){r._checkInputValidity(e),r.toggleButtonState()}))})),r.toggleButtonState()})),c(this,"toggleButtonState",(function(){r._hasInvalidInput()?r._disableButton():r._enableButton()})),c(this,"_disableButton",(function(){r._submitButton.classList.add(r._config.inactiveButtonClass),r._submitButton.disabled=!0})),c(this,"_enableButton",(function(){r._submitButton.classList.remove(r._config.inactiveButtonClass),r._submitButton.disabled=!1})),c(this,"_showError",(function(e){var t=r._form.querySelector(".".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(r._config.spanErrorClass),e.classList.add(r._config.inputErrorClass)})),c(this,"_hideError",(function(e){var t=r._form.querySelector(".".concat(e.id,"-error"));t.textContent="",t.classList.remove(r._config.spanErrorClass),e.classList.remove(r._config.inputErrorClass)})),c(this,"_hasInvalidInput",(function(){return r._inputsList.some((function(e){return!e.validity.valid}))})),c(this,"_checkInputValidity",(function(e){e.validity.valid?r._hideError(e):r._showError(e)})),this._config=t,this._form=n,this._inputsList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._submitButton=this._form.querySelector(this._config.submitButtonSelector)}var t,n;return t=e,(n=[{key:"resetValidation",value:function(){var e=this;this._inputsList.forEach((function(t){e._hideError(t)}))}}])&&a(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"_handleEscClose",(function(e){"Escape"===e.key&&n.close()})),s(this,"_handleClickClose",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-btn"))&&n.close()})),this._popup=document.querySelector(t)}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._popup.addEventListener("click",this._handleClickClose)}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(){return d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=_(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},d.apply(this,arguments)}function _(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function m(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function b(e){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},b(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=b(r);if(o){var n=b(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return m(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e))._popupImage=t._popup.querySelector(".popup__image"),t._popupCaption=t._popup.querySelector(".popup__caption"),t}return t=a,(n=[{key:"open",value:function(e,t){this._popupCaption.textContent=e,this._popupImage.alt="Изображение места - "+e,this._popupImage.src=t,d(b(a.prototype),"open",this).call(this)}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(f);function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=E(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},w.apply(this,arguments)}function E(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}function O(e,t){if(t&&("object"===g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}var L=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=j(r);if(o){var n=j(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return O(this,e)});function a(e,t){var n,r,o,c,l=e.submitForm;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),c=function(e){e.preventDefault(),n._submitForm(n._getInputValues())},(o="_handleSubmitForm")in(r=S(n=i.call(this,t)))?Object.defineProperty(r,o,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[o]=c,n._submitForm=l,n._formElement=n._popup.querySelector(".popup__form"),n._inputsList=n._formElement.querySelectorAll(".popup__field"),n._formButton=n._popup.querySelector(".popup__submit-btn"),n}return t=a,(n=[{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputsList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){w(j(a.prototype),"setEventListeners",this).call(this),this._formElement.addEventListener("submit",this._handleSubmitForm)}},{key:"close",value:function(){w(j(a.prototype),"close",this).call(this),this._formElement.reset()}},{key:"handleLoading",value:function(e){this._formButton.textContent=e?"Сохранение...":"Сохранить"}}])&&k(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(f);function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(){return R="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=B(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},R.apply(this,arguments)}function B(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=V(e)););return e}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function T(e,t){if(t&&("object"===P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}var x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=V(r);if(o){var n=V(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function a(e,t){var n,r=e.handleConfirmClick;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,t))._handleConfirmClick=r,n._confirmButton=n._popup.querySelector("#confirm-btn"),n._cardInfo={},n}return t=a,(n=[{key:"open",value:function(e){return R(V(a.prototype),"open",this).call(this),this._cardInfo=e}},{key:"setEventListeners",value:function(){var e=this;R(V(a.prototype),"setEventListeners",this).call(this),this._confirmButton.addEventListener("click",(function(){e._handleConfirmClick(e._cardInfo)}))}}])&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(f);function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t){var n=t.nameSelector,r=t.jobSelector,o=t.avatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=document.querySelector(n),this._job=document.querySelector(r),this._avatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return this._profileValues={},this._profileValues.name=this._name.textContent,this._profileValues.job=this._job.textContent,this._profileValues.avatar=this._avatar.src,this._profileValues}},{key:"setUserInfo",value:function(e){e.name&&(this._name.textContent=e.name),e.about&&(this._job.textContent=e.about),e.avatar&&(this._avatar.src=e.avatar)}}])&&U(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F={formSelector:".popup__form",inputSelector:".popup__field",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_inactive",inputErrorClass:"popup__field-error_line",spanErrorClass:"form__field-error"},A=document.querySelector("#profile"),H=document.querySelector("#place"),N=document.querySelector(".popup__field_type_name"),J=document.querySelector(".popup__field_type_job"),G=document.querySelector(".profile__btn_type_edit"),z=document.querySelector(".profile__btn_type_add"),M=document.querySelector(".elements__list"),K=document.querySelector(".profile__overlay"),Q=document.querySelector("#avatar"),W={},X=new t({url:"https://mesto.nomoreparties.co/v1/cohort-51",headers:{authorization:"0e40e2e7-5447-4a46-9984-9767d820a435","Content-Type":"application/json"}});X.getUserInfo().then((function(e){W.id=e._id,Z.setUserInfo(e),X.getInititalCards().then((function(e){Y.renderItems(e)})).catch((function(e){return console.log("Error: ".concat(e))}))})).catch((function(e){return console.log("Error: ".concat(e))}));var Y=new r({renderer:function(e){var t=oe(e);Y.appendItem(t)}},M),Z=new D({nameSelector:".profile__name",jobSelector:".profile__job",avatarSelector:".profile__image"}),$=new L({submitForm:function(e){$.handleLoading(!0),X.editUserInfo(e).then((function(e){Z.setUserInfo(e),$.close()})).catch((function(e){return console.log("Error: ".concat(e))})).finally($.handleLoading(!1))}},".popup_open-profile"),ee=new L({submitForm:function(e){ee.handleLoading(!0),X.addCard(e).then((function(e){var t=oe(e);Y.prependItem(t),ee.close()})).catch((function(e){return console.log("Error: ".concat(e))})).finally(ee.handleLoading(!1))}},".popup_open-element"),te=new L({submitForm:function(e){$.handleLoading(!0),X.editUserAvatar(e).then((function(e){Z.setUserInfo(e),te.close()})).catch((function(e){return console.log("Error: ".concat(e))})).finally($.handleLoading(!1))}},".popup_open-avatar"),ne=new v(".popup_open-image"),re=new x({handleConfirmClick:function(e){!function(e){X.deleteCard(e.getId()).then((function(){e.deleteCardHandler(),re.close()})).catch((function(e){return console.log("".concat(e))}))}(e)}},".popup_open-confirm");function oe(e){var t=new i({data:e,handleCardClick:function(e,t){ne.open(e,t)},handleRemoveClick:function(){re.open(t)},handleLikeClick:function(e){e.target.classList.contains("element__like-btn_active")?function(e){X.removeLike(e.getId()).then((function(t){e.likeCardHandler(t.likes.length)})).catch((function(e){return console.log("Error: ".concat(e))}))}(t):function(e){X.addLike(e.getId()).then((function(t){e.likeCardHandler(t.likes.length)})).catch((function(e){return console.log("Error: ".concat(e))}))}(t)},userId:W.id},".place-template");return t.generateCard()}var ie=new l(F,A);ie.enableValidation();var ae=new l(F,H);ae.enableValidation();var ce=new l(F,Q);ce.enableValidation(),ne.setEventListeners(),$.setEventListeners(),ee.setEventListeners(),te.setEventListeners(),re.setEventListeners(),G.addEventListener("click",(function(){$.open();var e=Z.getUserInfo();N.value=e.name,J.value=e.job,ie.resetValidation()})),z.addEventListener("click",(function(){ee.open(),ae.resetValidation(),ae.toggleButtonState()})),K.addEventListener("click",(function(){te.open(),ce.resetValidation(),ce.toggleButtonState()}))})();